-- CREATING THE USER AT THE SERVER LEVEL

USE [master]
GO
CREATE LOGIN [CPR\cmdbsrv] FROM WINDOWS WITH DEFAULT_DATABASE=[master]
GO

-- CREATE ROLE, USER and SCHEMA in MASTER DATABASE

CREATE ROLE [CMDB_CMDBSRV] AUTHORIZATION [dbo]
GO

CREATE SCHEMA [CMDB_CMDBSRV] AUTHORIZATION [CMDB_CMDBSRV]
GO

CREATE USER [CPR\cmdbsrv] FOR LOGIN [CPR\cmdbsrv] WITH DEFAULT_SCHEMA=[CPR\cmdbsrv]
GO


CREATE SCHEMA [CPR\cmdbsrv] AUTHORIZATION [CPR\cmdbsrv]
GO

-- ASSIGN SELECT PREVILEGES TO THE FOLLOWING VIEWS

GRANT SELECT ON sysdatabases TO CMDB_CMDBSRV
GRANT SELECT ON syslogins TO CMDB_CMDBSRV
GRANT SELECT ON sysperfinfo TO CMDB_CMDBSRV
GRANT SELECT ON sysprocesses TO CMDB_CMDBSRV

-- CREATE ROLE, USER and SCHEMA in MSDB DATABASE

USE [msdb]
GO

CREATE ROLE [CMDB_CMDBSRV] AUTHORIZATION [dbo]
GO


CREATE SCHEMA [CMDB_CMDBSRV] AUTHORIZATION [CMDB_CMDBSRV]
GO

CREATE USER [CPR\cmdbsrv] FOR LOGIN [CPR\cmdbsrv] WITH DEFAULT_SCHEMA=[CPR\cmdbsrv]
GO

CREATE SCHEMA [CPR\cmdbsrv] AUTHORIZATION [CPR\cmdbsrv]
GO

-- ASSIGN SELECT PREVILEGES TO THE FOLLOWING VIEWS

GRANT SELECT ON backupset TO CMDB_CMDBSRV
GRANT SELECT ON sysalerts TO CMDB_CMDBSRV
GRANT SELECT ON sysjobhistory TO CMDB_CMDBSRV
GRANT SELECT ON sysjobs TO CMDB_CMDBSRV
GRANT SELECT ON sysjobschedules TO CMDB_CMDBSRV
